# デプロイ後の次のステップ

アプリケーションが正常に動作していることを確認したら、次に何をすべきかを説明します。

## 📋 現在の状態

✅ デプロイ完了  
✅ Unicornが正常に動作  
✅ Nginxが正常に動作  
✅ HTTPでアクセス可能  
✅ アプリケーションが表示される

---

## 🎯 次のステップ（優先順位順）

### 1. アプリケーションの機能テスト（最重要）

まず、アプリケーションが正常に動作するか確認しましょう。

#### 確認すべき項目

- [ ] **トップページが表示される**
- [ ] **ログイン機能が動作する**
- [ ] **新規登録機能が動作する**
- [ ] **主要なページ遷移が正常に動作する**
- [ ] **画像が正しく表示される**
- [ ] **フォーム送信が正常に動作する**

#### 確認方法

ブラウザで以下にアクセスし、各機能をテストします：

```
http://3.115.160.151
```

**問題が見つかった場合:**
- ログを確認してください
  ```bash
  ssh -i ~/.ssh/my-key-pair.pem ec2-user@3.115.160.151
  tail -50 /var/www/furima-46419/shared/log/production.log
  ```

---

### 2. セキュリティ設定

#### 2-1. SSL証明書の設定（推奨）

**現在の状態:** HTTP（暗号化なし）で動作中

**推奨される対応:**
- ドメイン名を取得してSSL証明書を設定
- HTTPSでアクセス可能にする

**詳細ガイド:**
- [SSL証明書設定ガイド](ssl_certificate_setup_guide.md) を参照

**ドメイン名がない場合:**
- 開発・テスト環境の場合は、HTTPのままでも問題ありません
- 本番環境では、セキュリティ上SSL証明書の設定を強く推奨します

#### 2-2. ファイアウォール設定

EC2のセキュリティグループで、必要なポートのみを開放するように設定してください。

**確認すべきポート:**
- ✅ **22 (SSH)**: サーバー管理用
- ✅ **80 (HTTP)**: Webアクセス用
- ✅ **443 (HTTPS)**: SSL証明書設定後
- ❌ その他のポートは閉じる

#### 2-3. ログの定期監視

定期的にログを確認して、異常がないかチェックしましょう。

```bash
# エラーログの確認
tail -50 /var/www/furima-46419/shared/log/production.log

# Unicornのエラーログ
tail -50 /var/www/furima-46419/shared/log/unicorn.stderr.log
```

---

### 3. パフォーマンス最適化

#### 3-1. データベースのインデックス確認

データベースクエリが遅い場合は、インデックスが適切に設定されているか確認してください。

#### 3-2. キャッシュ設定

Railsのキャッシュ機能を活用して、パフォーマンスを向上させることができます。

#### 3-3. アセットの最適化

既にアセットプリコンパイルは設定されていますが、必要に応じて最適化を行います。

---

### 4. 監視とアラート設定

#### 4-1. サーバー監視

以下のツールを使用してサーバーの状態を監視できます：

- **AWS CloudWatch**: EC2の状態監視
- **New Relic**: アプリケーションパフォーマンス監視
- **Sentry**: エラー監視

#### 4-2. ログ監視

定期的にログを確認するか、自動監視ツールを導入します。

---

### 5. バックアップ設定

#### 5-1. データベースのバックアップ

データベースの定期バックアップを設定しましょう。

```bash
# バックアップスクリプトの例
mysqldump -u username -p database_name > backup_$(date +%Y%m%d).sql
```

#### 5-2. ファイルのバックアップ

アップロードされたファイルなど、重要なファイルのバックアップも設定しましょう。

---

### 6. ドキュメント作成

#### 6-1. 運用マニュアル

- デプロイ手順
- トラブルシューティング手順
- 重要な設定ファイルの場所

#### 6-2. 開発者向けドキュメント

- 開発環境のセットアップ手順
- コーディング規約
- 開発フロー

---

## 🚨 よくある問題と対処法

### 問題1: アプリケーションが表示されない

**確認ポイント:**
1. Unicornが起動しているか
   ```bash
   ps aux | grep unicorn
   ```

2. Nginxが起動しているか
   ```bash
   sudo systemctl status nginx
   ```

3. ログにエラーがないか
   ```bash
   tail -50 /var/www/furima-46419/shared/log/production.log
   ```

### 問題2: データベース接続エラー

**確認ポイント:**
1. データベースが起動しているか
   ```bash
   sudo systemctl status mysqld
   ```

2. 接続情報が正しいか
   ```bash
   cat /var/www/furima-46419/shared/config/database.yml
   ```

### 問題3: アセット（CSS、画像）が表示されない

**確認ポイント:**
1. アセットプリコンパイルが実行されたか
   ```bash
   ls -la /var/www/furima-46419/current/public/assets/
   ```

2. Nginx設定の `root` が正しいか
   ```bash
   cat /etc/nginx/conf.d/rails.conf | grep root
   ```

---

## 📅 定期的なメンテナンス

### 毎日
- [ ] アプリケーションが正常に動作しているか確認
- [ ] エラーログに異常がないか確認

### 毎週
- [ ] サーバーのリソース使用状況を確認
- [ ] ログファイルのサイズを確認
- [ ] セキュリティアップデートを確認

### 毎月
- [ ] データベースのバックアップを確認
- [ ] SSL証明書の有効期限を確認（Let's Encryptの場合は自動更新されます）
- [ ] 依存関係のアップデートを確認

---

## 🎓 学習リソース

### Rails関連
- [Rails Guides](https://guides.rubyonrails.org/)
- [Rails API Documentation](https://api.rubyonrails.org/)

### Nginx関連
- [Nginx公式ドキュメント](https://nginx.org/en/docs/)

### インフラ関連
- [AWS公式ドキュメント](https://docs.aws.amazon.com/)
- [Capistrano公式ドキュメント](http://capistranorb.com/)

---

## ✅ チェックリスト

デプロイ後の確認事項：

- [ ] アプリケーションが表示される
- [ ] 主要な機能が動作する
- [ ] エラーログに重大な問題がない
- [ ] セキュリティ設定を確認
- [ ] バックアップ設定を確認
- [ ] 監視設定を検討

---

## 📞 サポート

問題が発生した場合：

1. **ログを確認する**
   - アプリケーションログ
   - Unicornログ
   - Nginxログ

2. **ドキュメントを参照する**
   - [Nginx設定確認ガイド](nginx_application_check_guide.md)
   - [クイックリファレンス](quick_reference.md)

3. **トラブルシューティングガイドを参照する**
   - [クイックリファレンス - よくあるトラブル](quick_reference.md#よくあるトラブルと解決方法)

---

**🎉 おめでとうございます！アプリケーションのデプロイが完了しました！**

