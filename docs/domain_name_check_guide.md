# ドメイン名の確認方法

フリマアプリにドメイン名が設定されているかを確認する方法を説明します。

## 📋 確認方法一覧

1. [サーバー側の設定ファイルを確認](#方法1-サーバー側の設定ファイルを確認)（最も確実）
2. [ブラウザでドメイン名でアクセスする](#方法2-ブラウザでドメイン名でアクセスする)
3. [DNSレコードを確認する](#方法3-dnsレコードを確認する)
4. [プロジェクトの設定ファイルを確認](#方法4-プロジェクトの設定ファイルを確認)

---

## 方法1: サーバー側の設定ファイルを確認（最も確実）

### ステップ1: サーバーにSSH接続

```bash
ssh -i ~/.ssh/my-key-pair.pem ec2-user@3.115.160.151
```

### ステップ2: Nginx設定ファイルを確認

```bash
cat /etc/nginx/conf.d/rails.conf | grep server_name
```

### 確認結果の見方

#### IPアドレスのみの場合（ドメイン名なし）

```nginx
server_name 3.115.160.151;
```

この場合は、**ドメイン名が設定されていません**。

#### ドメイン名が設定されている場合

```nginx
server_name example.com www.example.com;
```

または

```nginx
server_name example.com;
```

この場合は、**ドメイン名が設定されています**。

---

## 方法2: ブラウザでドメイン名でアクセスする

### ステップ1: ドメイン名を推測する

以下のようなドメイン名の可能性があります：
- プロジェクト名に関連: `furima-46419.com`
- あなたの名前に関連: `yourname.com`
- サービス名に関連: `frima.com`

### ステップ2: ブラウザでアクセスを試す

ブラウザのアドレスバーに以下を入力してアクセスします：

```
http://[推測したドメイン名]
```

例：
```
http://furima-46419.com
http://yourname.com
```

### 確認結果

- ✅ **アプリケーションが表示される**: ドメイン名が設定されています
- ❌ **「このサイトにアクセスできません」と表示される**: ドメイン名は設定されていないか、DNS設定が正しくありません

---

## 方法3: DNSレコードを確認する

ドメイン名を取得した覚えがある場合、DNSレコードを確認します。

### ステップ1: ドメイン名の取得元を確認

以下のようなドメイン名サービスを使用している可能性があります：
- お名前.com
- ムームードメイン
- Google Domains
- AWS Route 53
- Freenom（無料ドメイン）

### ステップ2: DNSレコードを確認

ドメイン名サービスの管理画面にログインして、以下の設定を確認します：

**確認するレコード:**
- **Aレコード**: ドメイン名がサーバーのIPアドレス（`3.115.160.151`）を指しているか

**設定例:**
```
ホスト名: @ (または空白)
種類: A
値: 3.115.160.151
TTL: 3600
```

### ステップ3: DNS反映を確認（ローカルPCのターミナルで実行）

```bash
nslookup [あなたのドメイン名]
```

例：
```bash
nslookup example.com
```

**期待される結果:**
```
Name:    example.com
Address: 3.115.160.151
```

IPアドレスが `3.115.160.151` と表示されれば、DNS設定は正しく反映されています。

---

## 方法4: プロジェクトの設定ファイルを確認

### ステップ1: ローカルのプロジェクトを確認

GitHub Desktopを開いて、以下のファイルを確認します：

**ファイル:** `config/deploy/production.rb`

### ステップ2: server設定を確認

ファイルを開いて、以下の行を確認します：

```ruby
server '3.115.160.151', user: 'ec2-user', roles: %w{app db web}
```

#### IPアドレスのみの場合（ドメイン名なし）

```ruby
server '3.115.160.151', user: 'ec2-user', roles: %w{app db web}
```

この場合は、**ドメイン名が設定されていません**。

#### ドメイン名が設定されている場合

```ruby
server 'example.com', user: 'ec2-user', roles: %w{app db web}
```

または

```ruby
server '3.115.160.151', user: 'ec2-user', roles: %w{app db web}
# コメントにドメイン名が記載されている場合もある
```

---

## 現在の状態を確認する（まとめチェック）

以下のコマンドを順番に実行して、現在の状態を確認します：

```bash
# 1. サーバーに接続
ssh -i ~/.ssh/my-key-pair.pem ec2-user@3.115.160.151

# 2. Nginx設定のserver_nameを確認
cat /etc/nginx/conf.d/rails.conf | grep server_name
```

### 結果の判断

#### パターンA: IPアドレスのみ

```nginx
server_name 3.115.160.151;
```

**結論:** 
- ❌ **ドメイン名は設定されていません**
- 現在はIPアドレスのみでアクセス可能です
- SSL証明書を設定するには、ドメイン名が必要です

#### パターンB: ドメイン名が設定されている

```nginx
server_name example.com www.example.com;
```

**結論:**
- ✅ **ドメイン名が設定されています**
- SSL証明書を設定できます
- `docs/ssl_certificate_setup_guide.md` を参照してください

---

## よくある質問（FAQ）

### Q1: ドメイン名を忘れてしまった

**A:** 以下の方法で確認できます：

1. ドメイン名サービスの管理画面を確認
2. メールボックスにドメイン取得時のメールがあるか確認
3. ブラウザの履歴でアクセスしたURLを確認

### Q2: ドメイン名はあるけど、DNS設定が反映されていない

**A:** DNS設定の反映には時間がかかります：
- 通常: 数分〜数時間
- 最大: 24〜48時間

以下のコマンドで反映状況を確認できます：

```bash
nslookup [ドメイン名]
```

### Q3: ドメイン名がない場合、SSL証明書は設定できない？

**A:** はい、Let's Encryptはドメイン名が必要です。IPアドレスのみでは証明書を発行できません。

**選択肢:**
1. ドメイン名を取得する（有料: 月額数百円程度）
2. 開発環境としてHTTPのまま使用する（本番環境では非推奨）

### Q4: 無料でドメイン名を取得できる？

**A:** 可能ですが、注意が必要です：

- **Freenom**: `.tk`, `.ml`, `.ga` などの無料ドメイン
  - ただし、信頼性が低く、突然利用できなくなる場合がある
- **本番環境**: 有料ドメインの使用を強く推奨（月額数百円程度）

---

## 次のステップ

### ドメイン名が**ある**場合

1. DNS設定が正しく反映されているか確認
2. SSL証明書を設定する
   - `docs/ssl_certificate_setup_guide.md` を参照

### ドメイン名が**ない**場合

1. 開発環境の場合: 現在の状態（HTTP）のままで問題ありません
2. 本番環境の場合: ドメイン名を取得してSSL証明書を設定することを推奨します

---

**💡 ヒント**: 最も確実な確認方法は「方法1: サーバー側の設定ファイルを確認」です。まずはこちらを実行してみてください。

